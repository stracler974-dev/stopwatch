<!DOCTYPE html>
<html class="dark" lang="en">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport"/>
  <link href="https://fonts.googleapis.com" rel="preconnect"/>
  <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&family=Inter:wght@400;500&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            primary: "#137fec",
            "background-light": "#f6f7f8",
            "background-dark": "#101922",
          },
          fontFamily: {
            display: ["Space Grotesk"],
            sans: ["Inter", "sans-serif"],
          },
          borderRadius: {
            DEFAULT: "0.5rem",
            lg: "1rem",
            xl: "1.5rem",
            full: "9999px",
          },
          keyframes: {
            pulseGlow: {
              '0%, 100%': { opacity: '1', textShadow: '0 0 5px rgba(255, 255, 255, 0)' },
              '50%': { opacity: '0.95', textShadow: '0 0 10px rgba(19, 127, 236, 0.5)' },
            },
            gradient: {
              '0%': { backgroundPosition: '0% 50%' },
              '50%': { backgroundPosition: '100% 50%' },
              '100%': { backgroundPosition: '0% 50%' },
            },
          },
          animation: {
            pulseGlow: 'pulseGlow 2s ease-in-out infinite',
            gradient: 'gradient 15s ease infinite',
          }
        },
      },
    };
  </script>
  <title>Stopwatch</title>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      overflow: hidden; /* lock whole page */
      touch-action: manipulation;
    }
    #laps { -webkit-overflow-scrolling: touch; }
  </style>
</head>
<body class="bg-background-light dark:bg-gradient-to-br dark:from-background-dark dark:via-[#131d28] dark:to-[#0d151c] dark:bg-[length:200%_200%] dark:animate-gradient font-display text-white">
<div class="flex flex-col h-screen">
  <!-- Header -->
  <header class="relative flex items-center justify-center p-4 flex-shrink-0">
    <h1 class="text-lg font-bold text-center text-black dark:text-white">Stopwatch</h1>
    <button class="absolute right-4 p-2 rounded-full text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 focus:outline-none" id="theme-toggle">
      <span class="material-symbols-outlined dark:hidden">dark_mode</span>
      <span class="material-symbols-outlined hidden dark:inline">light_mode</span>
    </button>
  </header>

  <!-- Main -->
  <main class="flex-grow flex flex-col items-center px-4 pb-4 min-h-0">
    <!-- Display -->
    <div class="text-center pt-8">
      <h2 id="display" class="text-7xl font-bold tracking-tighter text-black dark:text-white animate-pulseGlow">00:00.00</h2>
    </div>

    <!-- Controls -->
    <div class="grid grid-cols-2 gap-4 w-full max-w-sm mt-6 mb-4">
      <button id="lapBtn" class="bg-gray-200 dark:bg-gray-800 text-black dark:text-white font-bold py-4 rounded-full text-lg" disabled>Lap</button>
      <button id="startStopBtn" class="bg-green-500 text-white font-bold py-4 rounded-full text-lg">Start</button>
    </div>

    <!-- Reset -->
    <div class="w-full max-w-sm mb-4">
      <button id="resetBtn" class="w-full bg-transparent text-gray-500 dark:text-gray-400 font-bold py-4 rounded-full text-lg border border-gray-300 dark:border-gray-700" disabled>Reset</button>
    </div>

    <!-- Lap History -->
    <div class="w-full max-w-sm flex-grow flex flex-col min-h-0 
                bg-white dark:bg-gray-900/50 rounded-xl bg-clip-padding 
                backdrop-filter backdrop-blur-xl bg-opacity-60 
                dark:bg-opacity-20 border border-gray-200 dark:border-gray-800">
      <div class="sticky top-0 bg-white/50 dark:bg-gray-900/50 backdrop-blur-sm z-10">
        <div class="grid grid-cols-3 gap-4 px-4 py-3 text-sm font-bold 
                    text-black dark:text-white border-b border-gray-200 
                    dark:border-gray-800 font-sans text-lg items-center">
          <span class="text-left font-extrabold col-span-2">Lap History</span>
          <button id="clearAllBtn" class="text-right text-xs font-medium text-red-500 hover:text-red-400 justify-self-end">Clear All</button>
        </div>
      </div>

      <!-- SCROLLABLE LAPS -->
      <div id="laps" class="flex-grow min-h-0 overflow-y-auto divide-y divide-gray-200 dark:divide-gray-800 font-sans">
        <!-- Lap rows injected here -->
      </div>
    </div>
  </main>
</div>

<audio id="lap-sound" preload="auto" src="https://cdn.pixabay.com/audio/2022/03/15/audio_51c721a117.mp3"></audio>

<script>
  // Timer state
  let startTime = 0, elapsed = 0, timerInterval = null;
  let lapCount = 0, lastLapTime = 0;
  let laps = [];

  // Elements
  const display = document.getElementById("display");
  const startStopBtn = document.getElementById("startStopBtn");
  const lapBtn = document.getElementById("lapBtn");
  const resetBtn = document.getElementById("resetBtn");
  const lapsContainer = document.getElementById("laps");
  const clearAllBtn = document.getElementById("clearAllBtn");
  const sound = document.getElementById("lap-sound");

  function formatTime(ms) {
    const totalSeconds = Math.floor(ms / 1000);
    const minutes = String(Math.floor(totalSeconds / 60)).padStart(2, "0");
    const seconds = String(totalSeconds % 60).padStart(2, "0");
    const centiseconds = String(Math.floor((ms % 1000) / 10)).padStart(2, "0");
    return `${minutes}:${seconds}.${centiseconds}`;
  }

  function updateTime() {
    elapsed = Date.now() - startTime;
    display.textContent = formatTime(elapsed);
  }

  function renderLaps() {
    lapsContainer.innerHTML = "";
    for (let i = laps.length - 1; i >= 0; i--) {
      const lap = laps[i];
      const div = document.createElement("div");
      div.className = "grid grid-cols-3 gap-4 px-4 py-3 items-center text-black dark:text-white";
      div.innerHTML = `
        <span class="text-left font-medium">Lap ${lap.id}</span>
        <span class="text-center">+${formatTime(lap.lapTime)}</span>
        <span class="text-right">${formatTime(lap.total)}</span>
      `;
      lapsContainer.appendChild(div);
    }
    // Keep newest visible
    lapsContainer.scrollTop = 0;
  }

  // Start/Stop
  startStopBtn.addEventListener("click", () => {
    navigator.vibrate?.(10);

    if (timerInterval) {
      clearInterval(timerInterval);
      timerInterval = null;
      startStopBtn.textContent = "Start";
      startStopBtn.classList.remove("bg-red-500");
      startStopBtn.classList.add("bg-green-500");
      lapBtn.disabled = true;
      resetBtn.disabled = false;
    } else {
      startTime = Date.now() - elapsed;
      timerInterval = setInterval(updateTime, 10);
      startStopBtn.textContent = "Stop";
      startStopBtn.classList.remove("bg-green-500");
      startStopBtn.classList.add("bg-red-500");
      lapBtn.disabled = false;
      resetBtn.disabled = false;
    }
  });

  // Lap
  lapBtn.addEventListener("click", () => {
    navigator.vibrate?.(10);
    if (!timerInterval) return;
    sound.currentTime = 0;
    sound.play().catch(()=>{});

    lapCount++;
    const lapTime = elapsed - lastLapTime;
    lastLapTime = elapsed;
    laps.push({ id: lapCount, lapTime, total: elapsed });
    renderLaps();
  });

  // Reset
  resetBtn.addEventListener("click", () => {
    navigator.vibrate?.(10);
    clearInterval(timerInterval);
    timerInterval = null;
    elapsed = 0; startTime = 0;
    lapCount = 0; lastLapTime = 0; laps = [];
    display.textContent = "00:00.00";
    lapsContainer.innerHTML = "";
    startStopBtn.textContent = "Start";
    startStopBtn.classList.remove("bg-red-500");
    startStopBtn.classList.add("bg-green-500");
    lapBtn.disabled = true;
    resetBtn.disabled = true;
  });

  // Clear All laps
  clearAllBtn.addEventListener("click", () => {
    navigator.vibrate?.(10);
    laps = [];
    lapCount = 0;
    lastLapTime = 0;
    lapsContainer.innerHTML = "";
  });

  // Theme toggle
  document.getElementById('theme-toggle').addEventListener('click', () => {
    document.documentElement.classList.toggle('dark');
  });
</script>
</body>
</html>
