<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport"/>
  <title>MovieFlix</title>
  <script src="https://cdn.tailwindcss.com?plugins=forms,typography,container-queries"></script>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
  <style>
    body {
      font-family: 'Montserrat', sans-serif;
      background-color: #000;
      min-height: max(884px, 100dvh);
    }
    .carousel-item {
      transition: opacity 0.5s ease-in-out;
    }
    .indicator-dot {
      transition: background-color 0.3s ease-in-out, transform 0.3s ease-in-out;
    }
  </style>
  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            primary: "#6a35f1",
            "footer-bg": "#1e1a31",
            "brand-purple": "#6a35f1",
            "footer-text": "#a1a1aa",
            "icon-bg": "#2d2a44",
          },
          fontFamily: {
            display: ["Montserrat", "sans-serif"],
          },
          borderRadius: {
            DEFAULT: "1rem",
          },
        },
      },
    };
  </script>
</head>
<body class="text-white">
  <div class="min-h-screen flex flex-col">

    <!-- NAVBAR -->
    <header class="bg-[#1e1a31]">
      <div class="container mx-auto px-4 py-3 flex justify-between items-center">
        <button class="text-white">
          <span class="material-icons">menu</span>
        </button>
        <div class="flex items-center space-x-1 cursor-pointer" onclick="window.location.href='index.html'">
          <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center text-white font-bold text-lg">M</div>
          <h1 class="text-2xl font-bold text-white tracking-tighter">ovieFlix</h1>
        </div>
        <div class="flex items-center space-x-4">
          <button id="searchBtn" class="text-white">
            <span class="material-icons">search</span>
          </button>
        </div>
      </div>
    </header>

    <!-- HERO BANNER -->
    <main class="flex-grow">
      <div class="flex justify-center mt-6">
        <div class="max-w-md w-full rounded-lg shadow-lg overflow-hidden relative" id="hero-banner">
          <div class="carousel-container relative h-[250px] sm:h-[320px]">
            <!-- Movies injected here -->
          </div>
          <!-- Buttons -->
          <button class="absolute top-1/2 left-4 -translate-y-1/2 bg-white/50 dark:bg-black/50 p-2 rounded-lg text-primary" id="prevBtn">
            <span class="material-icons text-5xl">chevron_left</span>
          </button>
          <button class="absolute top-1/2 right-4 -translate-y-1/2 bg-white/50 dark:bg-black/50 p-2 rounded-lg text-primary" id="nextBtn">
            <span class="material-icons text-5xl">chevron_right</span>
          </button>
          <!-- Indicators -->
          <div class="absolute top-4 right-4 bg-white/50 rounded-full px-3 py-1.5 flex items-center space-x-2" id="indicator-container"></div>
        </div>
      </div>

      <!-- SOME MOVIES -->
      <div class="max-w-3xl mx-auto mt-10 px-4 mb-16">
        <h2 class="text-xl font-bold mb-6">Some Movies</h2>
        <div id="movies-container" class="grid grid-cols-2 gap-8">
          <!-- Movies injected here -->
        </div>
      </div>
    </main>

    <!-- ===== FOOTER ===== -->
    <footer class="bg-footer-bg text-center py-8">
      <div class="container mx-auto px-4">
        <div class="flex justify-center items-center mb-6">
          <div class="bg-brand-purple w-12 h-12 flex items-center justify-center rounded-lg mr-2">
            <span class="text-white text-3xl font-bold">M</span>
          </div>
          <span class="text-white text-4xl font-bold">MovieFlix</span>
        </div>
        <p class="text-footer-text text-sm mb-6">
          Copyright © MovieFlix. All Rights Reserved
        </p>
        <div class="flex justify-center space-x-4 mb-8">
          <button class="bg-icon-bg p-3 rounded-md hover:bg-brand-purple transition" id="shareBtn">
            <span class="material-icons">share</span>
          </button>
        </div>
        <p class="text-footer-text text-xs leading-relaxed max-w-2xl mx-auto">
          Disclaimer: This site does not store any files on its server. All contents are provided by non-affiliated third parties.
        </p>
      </div>
    </footer>
  </div>

  <!-- POPUP SEARCH BAR -->
  <div id="searchModal" class="fixed inset-0 z-50 hidden flex items-start justify-center mt-20">
    <div class="w-full max-w-xs">
      <div class="relative">
        <form id="searchForm">
          <input id="modalSearchInput"
            class="w-full h-11 bg-primary text-white placeholder-gray-300 rounded-full pl-5 pr-5 focus:outline-none focus:ring-2 focus:ring-white text-sm font-normal"
            placeholder="Enter movie name..."
            type="text"
          />
        </form>
      </div>
    </div>
  </div>

  <!-- TMDB SCRIPT -->
  <script>
    const API_KEY = "efa4a3a1fe3389fa70fa59b2802983f4";
    const BASE_URL = "https://api.themoviedb.org/3";

    const carouselContainer = document.querySelector(".carousel-container");
    const indicatorContainer = document.getElementById("indicator-container");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");

    let carouselItems = [];
    let currentIndex = 0;

    async function fetchMovies() {
      const randomPage = Math.floor(Math.random() * 50) + 1; // random page 1–50
      const res = await fetch(`${BASE_URL}/movie/popular?api_key=${API_KEY}&language=en-US&page=${randomPage}`);
      const data = await res.json();
      return data.results;
    }

    // HERO BANNER
    function renderCarousel(movies) {
      carouselContainer.innerHTML = "";
      movies.slice(0, 7).forEach((movie, index) => {
        const item = document.createElement("div");
        item.className = `carousel-item absolute inset-0 w-full h-full ${index === 0 ? "opacity-100" : "opacity-0"}`;
        item.innerHTML = `
          <img src="https://image.tmdb.org/t/p/w780${movie.backdrop_path}" alt="${movie.title}" class="w-full h-full object-cover"/>
          <div class="absolute inset-x-0 bottom-0 bg-primary p-4">
            <h2 class="text-white text-lg font-bold cursor-pointer" data-id="${movie.id}" data-title="${encodeURIComponent(movie.title)}">${movie.title}</h2>
          </div>
        `;
        carouselContainer.appendChild(item);
      });

      document.querySelectorAll(".carousel-item h2").forEach(title => {
        title.addEventListener("click", () => {
          const movieId = title.getAttribute("data-id");
          const movieTitle = title.getAttribute("data-title");
          window.location.href = `watch.html?id=${movieId}&title=${movieTitle}`;
        });
      });

      carouselItems = document.querySelectorAll(".carousel-item");
      createIndicators(7);
      updateCarousel();
    }

    function createIndicators(count) {
      indicatorContainer.innerHTML = "";
      for (let i = 0; i < count; i++) {
        const dot = document.createElement("button");
        dot.classList.add("indicator-dot", "w-2", "h-2", "rounded-full", "bg-black/50", "hover:bg-primary");
        dot.setAttribute("data-index", i);
        dot.addEventListener("click", () => {
          currentIndex = i;
          updateCarousel();
        });
        indicatorContainer.appendChild(dot);
      }
    }

    function updateIndicators() {
      const dots = document.querySelectorAll(".indicator-dot");
      dots.forEach((dot, index) => {
        if (index === currentIndex) {
          dot.classList.remove("bg-black/50", "w-2", "h-2");
          dot.classList.add("bg-primary", "w-3", "h-3");
        } else {
          dot.classList.add("bg-black/50", "w-2", "h-2");
          dot.classList.remove("bg-primary", "w-3", "h-3");
        }
      });
    }

    function updateCarousel() {
      carouselItems.forEach((item, index) => {
        item.classList.toggle("opacity-100", index === currentIndex);
        item.classList.toggle("opacity-0", index !== currentIndex);
      });
      updateIndicators();
    }

    function nextSlide() {
      currentIndex = (currentIndex + 1) % carouselItems.length;
      updateCarousel();
    }

    prevBtn.addEventListener("click", () => {
      currentIndex = (currentIndex - 1 + carouselItems.length) % carouselItems.length;
      updateCarousel();
    });

    nextBtn.addEventListener("click", nextSlide);

    setInterval(nextSlide, 5000);

    // MOVIES GRID
    function renderMovies(movies) {
      const container = document.getElementById("movies-container");
      container.innerHTML = "";
      movies.slice(0, 16).forEach(movie => {
        if (!movie.poster_path) return;
        const card = document.createElement("div");
        card.className = "group cursor-pointer";
        card.innerHTML = `
          <div class="relative w-40 rounded-lg overflow-hidden shadow-xl transition-all duration-300 ease-in-out group-hover:shadow-2xl group-hover:-translate-y-1">
            <div class="absolute top-2 left-2 bg-black bg-opacity-70 text-white text-xs font-bold px-2 py-1 rounded-md">HD</div>
            <img src="https://image.tmdb.org/t/p/w500${movie.poster_path}" alt="${movie.title}" class="w-full h-56 object-cover"/>
          </div>
          <div class="mt-2 text-center">
            <p class="text-sm font-medium text-gray-400 truncate">${movie.title}</p>
          </div>
        `;
        card.addEventListener("click", () => {
          const title = encodeURIComponent(movie.title || "");
          window.location.href = `watch.html?id=${movie.id}&title=${title}`;
        });
        container.appendChild(card);
      });
    }

    async function loadMovies() {
      const movies = await fetchMovies();
      renderCarousel(movies);
      renderMovies(movies);
    }

    loadMovies();
    setInterval(loadMovies, 600000); // refresh every 10 minutes

    // SEARCH BAR POPUP
    const searchBtn = document.getElementById("searchBtn");
    const searchModal = document.getElementById("searchModal");
    const modalSearchInput = document.getElementById("modalSearchInput");
    const searchForm = document.getElementById("searchForm");

    searchBtn.addEventListener("click", (e) => {
      e.stopPropagation();
      searchModal.classList.remove("hidden");
      modalSearchInput.focus();
    });

    document.addEventListener("click", (e) => {
      if (!searchModal.classList.contains("hidden") && !modalSearchInput.contains(e.target) && !searchBtn.contains(e.target)) {
        searchModal.classList.add("hidden");
      }
    });

    searchForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const query = modalSearchInput.value.trim();
      if (query) {
        window.location.href = `search.html?q=${encodeURIComponent(query)}`;
      }
    });

    // SHARE BUTTON
    const shareBtn = document.getElementById("shareBtn");
    shareBtn.addEventListener("click", async () => {
      const link = "https://posters0.gt.tc";
      try {
        await navigator.clipboard.writeText(link);
        alert("Site link copied: " + link);
      } catch (err) {
        alert("Failed to copy link");
      }
    });
  </script>
</body>
</html>
